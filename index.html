<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Arrhenius</title>
    <!-- Incluye Tailwind CSS para el estilizado -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define la fuente Inter y estilos generales para el cuerpo */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Contenedor principal de la aplicaci√≥n */
        .container {
            width: 100%;
            max-width: 900px;
            background-color: #2d3748;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 10px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Encabezado y botones de navegaci√≥n principal */
        .header {
            background-color: #4a5568;
            padding: 1.5rem;
            text-align: center;
            border-bottom: 2px solid #2d3748;
        }
        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #a0aec0;
        }
        .nav-buttons {
            display: flex;
            justify-content: center;
            background-color: #2d3748;
            border-bottom: 1px solid #4a5568;
            padding: 0.5rem 0;
        }
        .nav-buttons button {
            flex-grow: 1;
            padding: 1rem 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: #e2e8f0;
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        .nav-buttons button.active {
            background-color: #4a5568;
            color: #ffffff;
            border-bottom: 2px solid #6b7280;
        }
        .nav-buttons button:not(.active):hover {
            background-color: #3b4557;
        }

        /* Estilos del √°rea de contenido principal y scrollbar */
        .content {
            padding: 2rem;
            overflow-y: auto;
            max-height: 70vh;
            scrollbar-width: thin;
            scrollbar-color: #4a5568 #2d3748;
        }
        .content::-webkit-scrollbar {
            width: 8px;
        }
        .content::-webkit-scrollbar-track {
            background: #2d3748;
        }
        .content::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 20px;
            border: 2px solid #2d3748;
        }
        /* La clase `active` ahora controla la visibilidad */
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }

        /* Estilos para los formularios y entradas de texto */
        .form-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        input, select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #4a5568;
            background-color: #1a202c;
            color: #e2e8f0;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #a0aec0;
        }
        .btn-calc, .btn-gemini, .btn-ask-gemini {
            width: 100%;
            padding: 1rem;
            color: #fff;
            font-weight: 600;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-align: center;
        }
        .btn-calc {
            background-color: #38b2ac;
        }
        .btn-calc:hover {
            background-color: #319795;
            transform: translateY(-2px);
        }
        .btn-gemini {
            background-color: #6a6a6a;
            margin-top: 1rem;
        }
        .btn-gemini:hover {
            background-color: #555555;
            transform: translateY(-2px);
        }
        .btn-ask-gemini {
            background-color: #4c51bf;
        }
        .btn-ask-gemini:hover {
            background-color: #434190;
        }

        /* Estilos para el cuadro de resultados */
        .result-box {
            background-color: #4a5568;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-top: 2rem;
        }
        .result-box h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #a0aec0;
        }
        .result-box p {
            margin-bottom: 0.5rem;
        }

        /* Estilos de los botones de sub-navegaci√≥n */
        .sub-nav-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 2rem;
        }
        .sub-nav-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            background-color: #4a5568;
            color: #e2e8f0;
            border: none;
            transition: background-color 0.3s;
        }
        .sub-nav-buttons button.active {
            background-color: #a0aec0;
            color: #2d3748;
        }
        .sub-nav-buttons button:hover:not(.active) {
            background-color: #6b7280;
        }

        /* Estilos mejorados para las tablas de datos */
        .table-container {
            margin-bottom: 2rem;
            overflow-x: auto;
            max-width: 100%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background-color: #4a5568;
            border-radius: 0.5rem;
            overflow: hidden; /* Asegura que las esquinas redondeadas se apliquen correctamente */
        }
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #6b7280;
        }
        th {
            background-color: #2d3748;
            font-weight: 700;
            color: #a0aec0;
        }
        tr:last-child td {
            border-bottom: none;
        }
        .table-container h4 {
            color: #a0aec0;
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }

        /* Estilos mejorados para el glosario */
        .glossary-card {
            background-color: #4a5568;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .glossary-card h4 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #a0aec0;
        }
        .list-item h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: #a0aec0;
        }
        .radio-options {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .radio-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        .note {
            background-color: #1f2937;
            border-left: 4px solid #38b2ac;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
        }

        /* Estilos para la nueva secci√≥n de preguntas a Gemini */
        .ask-gemini-section {
            background-color: #2d3748;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            margin-top: 2rem;
        }

        .ask-gemini-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #a0aec0;
        }
        
        #gemini-question-textarea {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #4a5568;
            background-color: #1a202c;
            color: #e2e8f0;
            transition: border-color 0.3s;
            margin-bottom: 1rem;
        }
        
        #gemini-question-textarea:focus {
            outline: none;
            border-color: #a0aec0;
        }

        #gemini-theory-response-box {
            background-color: #4a5568;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
        }
        
        #gemini-theory-response-box h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #a0aec0;
        }

    </style>
</head>
<body class="bg-gray-900 text-gray-200">
    <div class="container">
        <!-- Encabezado de la aplicaci√≥n -->
        <div class="header">
            <h1>Calculadora de la Ley de Arrhenius</h1>
        </div>

        <!-- Botones de navegaci√≥n principal -->
        <div class="nav-buttons">
            <button id="btn-calculos" class="active">C√°lculos</button>
            <button id="btn-teoria">Teor√≠a y Datos</button>
            <button id="btn-manual">Manual de Uso</button>
        </div>
        
        <!-- Secci√≥n de C√°lculos -->
        <div id="calculos-section" class="section active content">
            <h2 class="text-2xl font-bold mb-6 text-center">C√°lculos de Vacancias y Espacios Intersticiales</h2>
            
            <form id="arrhenius-form">
                
                <!-- Input para N(t) -->
                <div class="form-group">
                    <label for="Nt-val">
                        N(t) (Concentraci√≥n)
                        <span id="Nt-unidad-label" class="text-sm font-normal">(deja vac√≠o para inc√≥gnita)</span>
                    </label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="Nt-val" placeholder="Valor num√©rico">
                        <select id="Nt-unit" class="w-1/2">
                            <option value="vacancies">Densidad de Vacancias</option>
                            <option value="interstitials">Densidad de Espacios Intersticiales</option>
                        </select>
                    </div>
                </div>

                <!-- Input para N0, con opci√≥n de c√°lculo -->
                <div class="form-group">
                    <label for="N0-val">N‚ÇÄ (Factor preexponencial)</label>
                    <div class="radio-options">
                        <label>
                            <input type="radio" name="N0-method" value="direct" id="N0-direct" checked>
                            N√∫mero Directo (√°tomos/m¬≥)
                        </label>
                        <label>
                            <input type="radio" name="N0-method" value="calculated" id="N0-calculated">
                            Calcular a partir de Par√°metro de Red
                        </label>
                    </div>
                    <div id="N0-direct-input">
                        <input type="text" id="N0-val" placeholder="ej: 3e22">
                    </div>
                    <div id="N0-calculated-input" class="hidden">
                        <div class="form-group">
                            <label for="n_atoms">N√∫mero de Espacios V√°lidos para Defectos Puntuales</label>
                            <input type="text" id="n_atoms" placeholder="ej: 2 para BCC, 4 para FCC, 6 para HCP">
                        </div>
                        <div class="form-group">
                            <label for="lattice-param">Par√°metro de Red (nm)</label>
                            <input type="text" id="lattice-param" placeholder="ej: 0.2866">
                        </div>
                    </div>
                </div>

                <!-- Input para Q -->
                <div class="form-group">
                    <label for="Q-val">Q (Energ√≠a de Activaci√≥n)</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="Q-val" placeholder="Valor num√©rico">
                        <select id="Q-unit" class="w-1/2">
                            <option value="J/atom">J/√°tomo</option>
                            <option value="eV/atom">eV/√°tomo</option>
                            <option value="J/mol">J/mol</option>
                            <option value="cal/mol">cal/mol</option>
                        </select>
                    </div>
                </div>

                <!-- Display de la constante k o R -->
                <div class="form-group">
                    <label for="k-const-display">K (Constante)</label>
                    <input type="text" id="k-const-display" value="Selecciona la unidad de Q" readonly class="text-gray-400 bg-gray-700">
                </div>

                <!-- Input para la Temperatura T -->
                <div class="form-group">
                    <label for="T-val">T (Temperatura)</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="T-val" placeholder="Valor num√©rico">
                        <select id="T-unit" class="w-1/2">
                            <option value="K">Kelvin (K)</option>
                            <option value="C">Grados Cent√≠grados (¬∞C)</option>
                            <option value="F">Grados Fahrenheit (¬∞F)</option>
                        </select>
                    </div>
                </div>

                <button type="button" id="calculate-btn" class="btn-calc">Calcular</button>
            </form>

            <!-- Cuadro para mostrar los resultados -->
            <div id="results" class="result-box hidden">
                <h3 class="text-xl font-bold">Resultados</h3>
                <div id="results-content"></div>
                <!-- Nuevo bot√≥n para el an√°lisis con Gemini -->
                <button type="button" id="gemini-analysis-btn" class="btn-gemini mt-4 hidden">
                    An√°lisis de Resultados ‚ú®
                </button>
                <!-- Secci√≥n para el an√°lisis generado por la IA -->
                <div id="gemini-analysis-box" class="mt-4 p-4 bg-gray-600 rounded-md hidden">
                    <h4 class="font-semibold mb-2">An√°lisis de la IA:</h4>
                    <p id="gemini-analysis-text">Cargando an√°lisis...</p>
                </div>
            </div>
        </div>
        
        <!-- Secci√≥n de Teor√≠a y Datos -->
        <div id="teoria-section" class="section content">
            <h2 class="text-2xl font-bold mb-6 text-center">Teor√≠a y Datos</h2>
            
            <!-- Contenido de la sub-secci√≥n Teor√≠a -->
            <div id="teoria-sub-section">
                <h3 class="text-xl font-semibold mb-4 text-cyan-400">Ley de Arrhenius en Metalurgia</h3>
                <p class="mb-4">La Ley de Arrhenius es fundamental en la ciencia de materiales, ya que nos ayuda a predecir c√≥mo la temperatura afecta la velocidad de procesos at√≥micos, como la **difusi√≥n** y la formaci√≥n de **vacancias** en un material s√≥lido. En pocas palabras, nos dice que si calientas un metal, sus √°tomos se mover√°n m√°s r√°pido y los procesos internos se acelerar√°n.</p>
                <p class="mb-4">La forma de la ecuaci√≥n que describe esto es: N(t) = N‚ÇÄ e^(-Q / kT)</p>
                <p class="mb-4 font-semibold text-cyan-400">Componentes de la Ecuaci√≥n:</p>
                <div class="list-item">
                    <h4>N(t):</h4>
                    <p>La concentraci√≥n de defectos (como vacancias o intersticios) en un momento dado. A medida que sube la temperatura, este valor aumenta, ya que hay m√°s energ√≠a para crear estos defectos.</p>
                </div>
                <div class="list-item">
                    <h4>N‚ÇÄ:</h4>
                    <p>El n√∫mero total de sitios disponibles para que los defectos se formen. Por ejemplo, en el caso de las vacancias, es el n√∫mero total de √°tomos en el material.</p>
                </div>
                <div class="list-item">
                    <h4>Q:</h4>
                    <p>La energ√≠a de activaci√≥n. Es la "barrera energ√©tica" que debe superarse para que un √°tomo se mueva o para que se forme un defecto. Un Q alto significa que el proceso es m√°s dif√≠cil de iniciar.</p>
                </div>
                <div class="list-item">
                    <h4>k:</h4>
                    <p>La constante de Boltzmann (1.38 x 10^-23 J/K), que convierte la temperatura en una medida de energ√≠a a nivel individual de las part√≠culas.</p>
                </div>
                <div class="list-item">
                    <h4>T:</h4>
                    <p>La temperatura absoluta, siempre en Kelvin.</p>
                </div>
                
                <h3 class="text-xl font-semibold mt-8 mb-4 text-cyan-400">Datos y Constantes</h3>
                <p class="mb-4">Para utilizar la ecuaci√≥n de Arrhenius, es crucial elegir la constante correcta (k o R) seg√∫n las unidades de energ√≠a de activaci√≥n (Q).</p>
                <p class="mb-4">La **constante de Boltzmann (kB)** se utiliza cuando Q se mide en unidades por √°tomo, como **J/√°tomo** (1.38 x 10^-23 J/K) o **eV/√°tomo** (8.62 x 10^-5 eV/K). Por otro lado, la **constante de los Gases Ideales (R)** se usa para unidades molares, como **J/mol** (8.314 J/(mol¬∑K)) o **cal/mol** (1.987 cal/(mol¬∑K)).</p>
                
                <p class="mb-4">Las propiedades de los metales tambi√©n son importantes. La estructura cristalina, como la **C√∫bica Centrada en el Cuerpo (BCC)** o la **C√∫bica Centrada en las Caras (FCC)**, determina el n√∫mero de √°tomos por celda unitaria (por ejemplo, 2 para BCC y 4 para FCC), un dato clave para calcular N‚ÇÄ. Adem√°s, el **par√°metro de red**, que es la longitud de los lados de la celda unitaria, var√≠a entre metales: el hierro (Fe) tiene una estructura BCC con un par√°metro de 0.2866 nm, mientras que el cobre (Cu) y el aluminio (Al) tienen una estructura FCC con par√°metros de 0.3615 nm y 0.4049 nm, respectivamente.</p>

                <h3 class="text-xl font-semibold mt-8 mb-4 text-cyan-400">Glosario de T√©rminos</h3>
                
                <div class="glossary-card">
                    <h4>Estructuras Cristalinas</h4>
                    <p>Se refieren a la forma ordenada en que los √°tomos se acomodan en un material s√≥lido. Esta disposici√≥n, como la BCC o FCC, define muchas de las propiedades f√≠sicas y mec√°nicas del material.</p>
                </div>
                
                <div class="glossary-card">
                    <h4>Par√°metro de Red</h4>
                    <p>Es la medida de la celda unitaria de un cristal, la cual es la unidad m√°s peque√±a que se repite para construir toda la red. Piensa en ello como la "longitud del lado" de la unidad b√°sica del material.</p>
                </div>
                
                <div class="glossary-card">
                    <h4>Defectos Puntuales</h4>
                    <p>Son imperfecciones o irregularidades a nivel at√≥mico dentro de una red cristalina. A pesar de su nombre, son cruciales para el comportamiento del material, ya que permiten la difusi√≥n y el movimiento de los √°tomos.</p>
                    <ul class="list-disc ml-6 mt-2">
                        <li><strong>Vacancia:</strong> Es un lugar en la red cristalina donde falta un √°tomo.</li>
                        <li><strong>√Åtomo Intersticial:</strong> Un √°tomo adicional que se ha metido en un espacio vac√≠o (intersticio) que normalmente no est√° ocupado.</li>
                    </ul>
                </div>
                
                <div class="glossary-card">
                    <h4>Energ√≠a de Activaci√≥n (Q)</h4>
                    <p>Es la cantidad m√≠nima de energ√≠a que se necesita para que ocurra un proceso. En metalurgia, es la energ√≠a requerida para que un √°tomo salte de un sitio a otro en el material. Es el "empuj√≥n" energ√©tico necesario para iniciar una acci√≥n.</p>
                </div>
            </div>

            <!-- Nueva secci√≥n para preguntas a Gemini sobre teor√≠a -->
            <div class="ask-gemini-section">
                <h3 class="text-center">Preg√∫ntale a Gemini sobre la teor√≠a üß†</h3>
                <textarea id="gemini-question-textarea" placeholder="Escribe tu pregunta aqu√≠ sobre la teor√≠a de Arrhenius o la ciencia de materiales..."></textarea>
                <button type="button" id="ask-gemini-btn" class="btn-ask-gemini">
                    Preguntar a Gemini
                </button>
            </div>
            
            <!-- Cuadro para mostrar la respuesta de Gemini -->
            <div id="gemini-theory-response-box" class="result-box hidden">
                <h4 class="font-semibold mb-2">Respuesta de la IA:</h4>
                <p id="gemini-theory-response-text">Cargando respuesta...</p>
            </div>
        </div>

        <!-- Secci√≥n de Manual de Uso -->
        <div id="manual-section" class="section content">
            <h2 class="text-2xl font-bold mb-6 text-center">Manual de Instrucciones de Uso</h2>
            
            <div class="list-item">
                <h4 class="font-bold">1. Apartado de c√°lculos:</h4>
                <ul class="list-disc ml-6">
                    <li>Solamente se deber√° dejar un espacio en blanco, el cual para el programa significa que es la inc√≥gnita.</li>
                    <li>Si la inc√≥gnita tiene m√°s de un tipo de unidad, entonces el programa te dar√° las respuestas con cada una de las unidades disponibles.</li>
                    <li>En el ingreso de datos no est√°n permitidas las comas ‚Äú,‚Äù, para colocar un n√∫mero con decimales se deber√° colocar el punto ‚Äú.‚Äù.</li>
                    <li>En el ingreso de datos el ingreso de n√∫meros con notaci√≥n cient√≠fica se deber√° realizar de la manera: `e#`. Por ejemplo: `3e22` = 3 x 10^22; `3e-34` = 3 x 10^-34. De lo contrario el programa no podr√° operar.</li>
                    <li>Cuando se quiera calcular N‚ÇÄ con par√°metro de red y espacios v√°lidos para defectos puntuales, solo se podr√° hacer si lo estamos calculando para estructuras cristalinas <strong>FCC</strong> y <strong>BCC</strong>.</li>
                    <li>El par√°metro de red y el n√∫mero de espacios v√°lidos para defectos puntuales no pueden ser inc√≥gnitas; solo pueden ser valores de entrada para el c√°lculo de N0. Sin embargo, N0 s√≠ puede ser la inc√≥gnita principal si los dem√°s valores (N(t), Q y T) est√°n presentes.</li>
                </ul>
                <div class="note">
                    <p><strong>Nota:</strong> Es importante tener conocimientos previos para poder interpretar los resultados dados.</p>
                </div>
            </div>
            
            <div class="list-item">
                <h4 class="font-bold">2. Apartado de Teor√≠a y datos:</h4>
                <ul class="list-disc ml-6">
                    <li>En este apartado podr√°s encontrar teor√≠a que relaciona la ley de Arrhenius con la ingenier√≠a metal√∫rgica. Este contenido es limitado, pero te puede ayudar.</li>
                    <li>En la secci√≥n de datos encontrar√°s datos que te pueden ayudar con los c√°lculos.</li>
                </ul>
            </div>
            
            <p class="text-center mt-8 font-semibold">¬°Disfruta la aplicaci√≥n y saca el mayor provecho!</p>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sections = {
                'calculos-section': document.getElementById('calculos-section'),
                'teoria-section': document.getElementById('teoria-section'),
                'manual-section': document.getElementById('manual-section')
            };
            const navButtons = {
                'btn-calculos': document.getElementById('btn-calculos'),
                'btn-teoria': document.getElementById('btn-teoria'),
                'btn-manual': document.getElementById('btn-manual')
            };

            const form = document.getElementById('arrhenius-form');
            const calculateBtn = document.getElementById('calculate-btn');
            const resultsBox = document.getElementById('results');
            const resultsContent = document.getElementById('results-content');
            const geminiAnalysisBtn = document.getElementById('gemini-analysis-btn');
            const geminiAnalysisBox = document.getElementById('gemini-analysis-box');
            const geminiAnalysisText = document.getElementById('gemini-analysis-text');

            // Nuevos elementos para la secci√≥n de teor√≠a
            const askGeminiBtn = document.getElementById('ask-gemini-btn');
            const geminiQuestionTextarea = document.getElementById('gemini-question-textarea');
            const geminiTheoryResponseBox = document.getElementById('gemini-theory-response-box');
            const geminiTheoryResponseText = document.getElementById('gemini-theory-response-text');
            
            const N0MethodDirect = document.getElementById('N0-direct');
            const N0MethodCalculated = document.getElementById('N0-calculated');
            const N0DirectInput = document.getElementById('N0-direct-input');
            const N0CalculatedInput = document.getElementById('N0-calculated-input');
            const QUnitSelect = document.getElementById('Q-unit');
            const KConstDisplay = document.getElementById('k-const-display');

            // Constantes para la ecuaci√≥n de Arrhenius
            const CONSTANTS = {
                'J/atom': { val: 1.380649e-23, unit: 'J/K', name: 'Boltzmann (k)' },
                'eV/atom': { val: 8.617333262e-5, unit: 'eV/K', name: 'Boltzmann (k)' },
                'J/mol': { val: 8.314462618, unit: 'J/(mol¬∑K)', name: 'Gases Ideales (R)' },
                'cal/mol': { val: 1.987204259, unit: 'cal/(mol¬∑K)', name: 'Gases Ideales (R)' }
            };

            // Mapeo de estructuras cristalinas para √°tomos/celda
            const LATTICE_ATOMS = {
                'BCC': 2,
                'FCC': 4
            };

            // Funci√≥n para cambiar entre secciones principales
            function switchSection(sectionId) {
                Object.values(sections).forEach(sec => sec.classList.remove('active'));
                sections[sectionId].classList.add('active');
                
                Object.values(navButtons).forEach(btn => btn.classList.remove('active'));
                navButtons[`btn-${sectionId.replace('-section', '')}`].classList.add('active');
            }
            
            // Eventos de navegaci√≥n principal
            Object.keys(navButtons).forEach(id => {
                navButtons[id].addEventListener('click', () => switchSection(id.replace('btn-', '') + '-section'));
            });
            
            // Configuraci√≥n de vista inicial
            switchSection('calculos-section');
            
            // L√≥gica para mostrar/ocultar los campos de entrada de N0
            N0MethodDirect.addEventListener('change', () => {
                N0DirectInput.classList.remove('hidden');
                N0CalculatedInput.classList.add('hidden');
            });

            N0MethodCalculated.addEventListener('change', () => {
                N0DirectInput.classList.add('hidden');
                N0CalculatedInput.classList.remove('hidden');
            });

            // Actualiza la constante 'k' seg√∫n la unidad de 'Q'
            QUnitSelect.addEventListener('change', () => {
                const selectedUnit = QUnitSelect.value;
                const constant = CONSTANTS[selectedUnit];
                KConstDisplay.value = `${constant.val.toPrecision(7)} ${constant.unit}`;
            });
            QUnitSelect.dispatchEvent(new Event('change'));

            // Funci√≥n para parsear notaci√≥n cient√≠fica y comas
            function parseInput(val) {
                if (!val) return null;
                return parseFloat(val.replace(/,/g, '.').replace(/([0-9])e([+-]?[0-9]+)/, '$1e$2'));
            }

            // Funci√≥n para formatear n√∫mero a 5 cifras significativas
            function formatNumber(num) {
                if (num === 0) return '0.0000';
                return num.toExponential(4); // 4 decimales para 5 cifras significativas
            }

            // Funci√≥n para llamar a la API de Gemini para el an√°lisis de c√°lculos
            async function getGeminiAnalysis(result, inputData, unknown) {
                geminiAnalysisBox.classList.remove('hidden');
                geminiAnalysisText.textContent = 'Generando an√°lisis...';
                geminiAnalysisText.classList.remove('text-red-400');
                
                const prompt = `
                    Eres un experto en metalurgia y ciencia de materiales. Proporciona un an√°lisis breve, simple y claro del siguiente resultado de c√°lculo de Arrhenius en espa√±ol, sin utilizar jerga t√©cnica de la academia.
                    
                    El c√°lculo fue:
                    - Inc√≥gnita: ${unknown}
                    - Resultado: ${result}
                    - Datos de entrada:
                        - N(t) (Concentraci√≥n): ${inputData.Nt_val}
                        - N0 (Factor preexponencial): ${inputData.N0_val}
                        - Q (Energ√≠a de Activaci√≥n): ${inputData.Q_val} ${inputData.Q_unit}
                        - T (Temperatura): ${inputData.T_val} ${inputData.T_unit}

                    Explica el significado f√≠sico del resultado calculado en un tono conversacional, amigable y no acad√©mico, relacion√°ndolo con procesos metal√∫rgicos del mundo real como la difusi√≥n, la transformaci√≥n de fase o el tratamiento t√©rmico. Mant√©n la respuesta en 2-3 p√°rrafos cortos y evita repetir los valores de entrada. Conc√©ntrate en la interpretaci√≥n del resultado en s√≠.
                `;

                // L√≥gica para la llamada a la API de Gemini
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                let response = null;
                let retryCount = 0;
                const maxRetries = 5;
                const initialDelay = 1000; // 1 segundo

                while (retryCount < maxRetries) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429) {
                            // Demasiadas solicitudes, implementa retroceso exponencial
                            const delay = initialDelay * Math.pow(2, retryCount);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            retryCount++;
                            continue;
                        }

                        if (!response.ok) {
                            throw new Error(`Fallo de la llamada a la API con estado: ${response.status}`);
                        }

                        const result = await response.json();
                        const text = result.candidates[0].content.parts[0].text;
                        geminiAnalysisText.textContent = text;
                        return;

                    } catch (error) {
                        console.error('Error al llamar a la API de Gemini:', error);
                        geminiAnalysisText.textContent = 'Hubo un error al generar el an√°lisis. Por favor, int√©ntalo de nuevo.';
                        geminiAnalysisText.classList.add('text-red-400');
                        return;
                    }
                }
                
                geminiAnalysisText.textContent = 'No se pudo conectar a la API despu√©s de varios intentos.';
                geminiAnalysisText.classList.add('text-red-400');
            }

            // Funci√≥n para llamar a la API de Gemini para preguntas de teor√≠a
            async function getGeminiTheoryResponse(question) {
                geminiTheoryResponseBox.classList.remove('hidden');
                geminiTheoryResponseText.textContent = 'Generando respuesta...';
                geminiTheoryResponseText.classList.remove('text-red-400');

                const prompt = `
                    Act√∫a como un profesor de ciencias de materiales y metalurgia. Responde la siguiente pregunta de un estudiante de una manera clara, concisa y f√°cil de entender. Usa un tono amigable y educativo. Si la pregunta no est√° relacionada con la ciencia de materiales, explica que tu conocimiento es limitado a ese campo. La pregunta es: "${question}"
                `;

                // L√≥gica para la llamada a la API de Gemini
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                let response = null;
                let retryCount = 0;
                const maxRetries = 5;
                const initialDelay = 1000;

                while (retryCount < maxRetries) {
                    try {
                        response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429) {
                            const delay = initialDelay * Math.pow(2, retryCount);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            retryCount++;
                            continue;
                        }

                        if (!response.ok) {
                            throw new Error(`Fallo de la llamada a la API con estado: ${response.status}`);
                        }

                        const result = await response.json();
                        const text = result.candidates[0].content.parts[0].text;
                        geminiTheoryResponseText.textContent = text;
                        return;

                    } catch (error) {
                        console.error('Error al llamar a la API de Gemini:', error);
                        geminiTheoryResponseText.textContent = 'Hubo un error al generar la respuesta. Por favor, int√©ntalo de nuevo.';
                        geminiTheoryResponseText.classList.add('text-red-400');
                        return;
                    }
                }
                
                geminiTheoryResponseText.textContent = 'No se pudo conectar a la API despu√©s de varios intentos.';
                geminiTheoryResponseText.classList.add('text-red-400');
            }

            // L√≥gica principal de c√°lculo
            calculateBtn.addEventListener('click', async () => {
                resultsContent.innerHTML = '';
                resultsBox.classList.add('hidden');
                geminiAnalysisBtn.classList.add('hidden');
                geminiAnalysisBox.classList.add('hidden');
                
                const Nt_val = parseInput(document.getElementById('Nt-val').value);
                const Q_val = parseInput(document.getElementById('Q-val').value);
                const T_val = parseInput(document.getElementById('T-val').value);
                
                let N0_val = null;
                const N0Method = document.querySelector('input[name="N0-method"]:checked').value;
                
                if (N0Method === 'direct') {
                    N0_val = parseInput(document.getElementById('N0-val').value);
                } else if (N0Method === 'calculated') {
                    // Obtiene los valores para el c√°lculo de N0
                    const n_atoms_input = document.getElementById('n_atoms').value;
                    const lattice_param_input = document.getElementById('lattice-param').value;
                    
                    if (!n_atoms_input || !lattice_param_input) {
                        resultsContent.innerHTML = '<p class="text-red-400">Error: Completa los campos para calcular N‚ÇÄ.</p>';
                        resultsBox.classList.remove('hidden');
                        return;
                    }
                    
                    const n_atoms = parseInput(n_atoms_input);
                    const lattice_param_m = parseInput(lattice_param_input) * 1e-9;
                    
                    const volume_m3 = Math.pow(lattice_param_m, 3);
                    N0_val = n_atoms / volume_m3;
                }
                
                const T_unit = document.getElementById('T-unit').value;
                const Q_unit = document.getElementById('Q-unit').value;
                const Nt_unit = document.getElementById('Nt-unit').value;
                const k_val = CONSTANTS[Q_unit].val;

                const values = { Nt: Nt_val, N0: N0_val, Q: Q_val, T: T_val };
                const unknowns = Object.keys(values).filter(key => values[key] === null);
                
                if (unknowns.length !== 1) {
                    resultsContent.innerHTML = '<p class="text-red-400">Error: Debes dejar exactamente una variable vac√≠a para calcular la inc√≥gnita.</p>';
                    resultsBox.classList.remove('hidden');
                    return;
                }
                
                const unknown = unknowns[0];
                let calculatedResult = null;
                let T_K = null;

                // Convierte la temperatura a Kelvin para el c√°lculo
                if (T_val !== null) {
                    switch (T_unit) {
                        case 'K': T_K = T_val; break;
                        case 'C': T_K = T_val + 273.15; break;
                        case 'F': T_K = (T_val - 32) * (5/9) + 273.15; break;
                    }
                }

                if (unknown === 'Nt') {
                    if (N0_val === null || Q_val === null || T_K === null) return;
                    calculatedResult = N0_val * Math.exp(-Q_val / (k_val * T_K));
                    resultsContent.innerHTML = `
                        <p class="mb-2"><strong>La inc√≥gnita es N(t)</strong></p>
                        <p>Resultado: ${formatNumber(calculatedResult)} ${Nt_unit === 'vacancies' ? 'Vacancias/m¬≥' : 'Espacios Intersticiales/m¬≥'}</p>
                    `;
                } else if (unknown === 'N0') {
                    if (Nt_val === null || Q_val === null || T_K === null) return;
                    calculatedResult = Nt_val / Math.exp(-Q_val / (k_val * T_K));
                    resultsContent.innerHTML = `
                        <p class="mb-2"><strong>La inc√≥gnita es N‚ÇÄ</strong></p>
                        <p>Resultado: ${formatNumber(calculatedResult)} √°tomos/m¬≥</p>
                    `;
                } else if (unknown === 'Q') {
                    if (Nt_val === null || N0_val === null || T_K === null) return;
                    if (N0_val === 0 || Nt_val === 0) {
                        resultsContent.innerHTML = '<p class="text-red-400">Error: El valor de N‚ÇÄ o N(t) no puede ser cero para este c√°lculo.</p>';
                        resultsBox.classList.remove('hidden');
                        return;
                    }
                    calculatedResult = -(k_val * T_K) * Math.log(Nt_val / N0_val);
                    resultsContent.innerHTML = `
                        <p class="mb-2"><strong>La inc√≥gnita es Q</strong></p>
                        <p>Resultado en ${Q_unit}: ${formatNumber(calculatedResult)}</p>
                    `;
                } else if (unknown === 'T') {
                    if (Nt_val === null || N0_val === null || Q_val === null) return;
                    if (N0_val === 0 || Nt_val === 0 || Nt_val > N0_val) {
                         resultsContent.innerHTML = '<p class="text-red-400">Error: Valores no v√°lidos para el c√°lculo de T. Aseg√∫rate de que N(t) no sea mayor que N‚ÇÄ y que ambos no sean cero.</p>';
                         resultsBox.classList.remove('hidden');
                         return;
                    }
                    calculatedResult = -Q_val / (k_val * Math.log(Nt_val / N0_val));
                    const T_Celsius = calculatedResult - 273.15;
                    const T_Fahrenheit = (calculatedResult - 273.15) * 9/5 + 32;
                    resultsContent.innerHTML = `
                        <p class="mb-2"><strong>La inc√≥gnita es T</strong></p>
                        <p>Resultado en Kelvin (K): ${formatNumber(calculatedResult)}</p>
                        <p>Resultado en Grados Cent√≠grados (¬∞C): ${formatNumber(T_Celsius)}</p>
                        <p>Resultado en Grados Fahrenheit (¬∞F): ${formatNumber(T_Fahrenheit)}</p>
                    `;
                }

                resultsBox.classList.remove('hidden');
                geminiAnalysisBtn.classList.remove('hidden');

                // Almacena los datos del c√°lculo para el an√°lisis de Gemini
                geminiAnalysisBtn.dataset.result = JSON.stringify(calculatedResult);
                geminiAnalysisBtn.dataset.unknown = unknown;
                geminiAnalysisBtn.dataset.inputData = JSON.stringify({
                    Nt_val, N0_val, Q_val, T_val, Q_unit, T_unit
                });
            });

            // Escuchador de eventos para el bot√≥n de an√°lisis de Gemini
            geminiAnalysisBtn.addEventListener('click', async () => {
                const unknown = geminiAnalysisBtn.dataset.unknown;
                const result = JSON.parse(geminiAnalysisBtn.dataset.result);
                const inputData = JSON.parse(geminiAnalysisBtn.dataset.inputData);
                await getGeminiAnalysis(result, inputData, unknown);
            });

            // Escuchador de eventos para el nuevo bot√≥n de preguntas de teor√≠a
            askGeminiBtn.addEventListener('click', async () => {
                const question = geminiQuestionTextarea.value.trim();
                if (question) {
                    await getGeminiTheoryResponse(question);
                }
            });
        });
    </script>
</body>
</html>
